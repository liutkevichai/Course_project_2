<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{_layout :: head}">
</head>
<body>
    <div th:replace="~{_layout :: header}"></div>
    <div th:replace="~{_layout :: sidebar}"></div>
    
    <main>
        <h1 th:text="${pageTitle}">Сделки</h1>
        
        <!-- Форма "Добавить запись" -->
        <section>
            <h2>Добавить запись</h2>
            <form th:action="@{/deals/add}" th:object="${newDeal}" method="post">
                <div>
                    <label for="clientId">Клиент:</label>
                    <select id="clientId" th:field="*{idClient}" required placeholder="Выберите клиента">
                        <option value="">Выберите клиента</option>
                        <option th:each="client : ${clients}"
                                th:value="${client.idClient}"
                                th:text="${client.getFullName()}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="realtorId">Риелтор:</label>
                    <select id="realtorId" th:field="*{idRealtor}" required placeholder="Выберите риелтора">
                        <option value="">Выберите риелтора</option>
                        <option th:each="realtor : ${realtors}"
                                th:value="${realtor.idRealtor}"
                                th:text="${realtor.getFullName()}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="propertyId">Недвижимость:</label>
                    <select id="propertyId" th:field="*{idProperty}" required placeholder="Выберите недвижимость">
                        <option value="">Выберите недвижимость</option>
                        <option th:each="property : ${properties}"
                                th:value="${property.propertyId}"
                                th:text="${property.getTableAddress()}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="dealTypeId">Тип сделки:</label>
                    <select id="dealTypeId" th:field="*{idDealType}" required placeholder="Выберите тип сделки">
                        <option value="">Выберите тип сделки</option>
                        <option th:each="type : ${dealTypes}"
                                th:value="${type.idDealType}"
                                th:text="${type.dealTypeName}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="dealDate">Дата сделки:</label>
                    <input type="date" id="dealDate" th:field="*{dealDate}" required placeholder="Дата сделки">
                </div>
                
                <div>
                    <label for="dealCost">Стоимость (₽):</label>
                    <input type="number" id="dealCost" th:field="*{dealCost}" step="1000" min="0" max="99999999.9999" required placeholder="Стоимость (₽)">
                </div>
                
                <button type="submit">Добавить</button>
            </form>
        </section>
        
        <!-- Форма "Найти запись" -->
        <section>
            <h2>Найти запись</h2>
            <form th:action="@{/deals}" method="get">
                <div>
                    <label for="startDate">Дата с:</label>
                    <input type="date" id="startDate" name="startDate" th:value="${searchStartDate}" placeholder="Дата с">
                </div>
                
                <div>
                    <label for="endDate">Дата по:</label>
                    <input type="date" id="endDate" name="endDate" th:value="${searchEndDate}" placeholder="Дата по">
                </div>
                
                <div>
                    <label for="searchRealtorId">Риелтор:</label>
                    <select id="searchRealtorId" name="realtorId" placeholder="Все риелторы">
                        <option value="">Все риелторы</option>
                        <option th:each="realtor : ${realtors}"
                                th:value="${realtor.idRealtor}"
                                th:text="${realtor.getFullName()}"
                                th:selected="${realtor.idRealtor == searchRealtorId}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="searchClientId">Клиент:</label>
                    <select id="searchClientId" name="clientId" placeholder="Все клиенты">
                        <option value="">Все клиенты</option>
                        <option th:each="client : ${clients}"
                                th:value="${client.idClient}"
                                th:text="${client.getFullName()}"
                                th:selected="${client.idClient == searchClientId}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="searchDealTypeId">Тип сделки:</label>
                    <select id="searchDealTypeId" name="dealTypeId" placeholder="Все типы">
                        <option value="">Все типы</option>
                        <option th:each="type : ${dealTypes}"
                                th:value="${type.idDealType}"
                                th:text="${type.dealTypeName}"
                                th:selected="${type.idDealType == searchDealTypeId}">
                        </option>
                    </select>
                </div>
                
                <button type="submit">Поиск</button>
            </form>
        </section>
        
        <!-- Таблица сделок -->
        <section>
            <h2>Список сделок</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Дата</th>
                        <th>Адрес недвижимости</th>
                        <th>Клиент</th>
                        <th>Риелтор</th>
                        <th>Стоимость</th>
                        <th>Тип</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="deal : ${deals}">
                        <td th:text="${deal.dealId}"></td>
                        <td th:text="${deal.getDealDateFormatted()}"></td>
                        <td th:text="${deal.propertyAddress}"></td>
                        <td th:text="${deal.clientName}"></td>
                        <td th:text="${deal.realtorName}"></td>
                        <td th:text="${deal.getDealCostFormatted()}"></td>
                        <td th:text="${deal.dealTypeName}"></td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Количество записей -->
            <p>Всего записей: <span th:text="${#lists.size(deals)}">0</span></p>
        </section>
    </main>
    
    <div th:replace="~{_layout :: footer}"></div>
</body>
</html>