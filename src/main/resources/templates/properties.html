<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{_layout :: head}">
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet">
</head>
<body>
    <div th:replace="~{_layout :: header}"></div>
    <div th:replace="~{_layout :: sidebar}"></div>
    
    <main>
        <h1 th:text="${pageTitle}">Недвижимость</h1>
        
        <!-- Форма "Добавить запись" -->
        <section>
            <h2>Добавить запись</h2>
            <form id="propertyAddForm" th:action="@{/properties/add}" th:object="${newProperty}" method="post">
                <!-- Основные данные -->
                <div>
                    <label for="area">Площадь (м²):</label>
                    <input type="number" id="area" th:field="*{area}" step="0.1" min="0" max="10000.00" required placeholder="Площадь (м²)">
                </div>
                <div>
                    <label for="cost">Стоимость (₽):</label>
                    <input type="number" id="cost" th:field="*{cost}" step="1000" min="0" max="99999999.99" required placeholder="Стоимость (₽)">
                </div>
                <div>
                    <label for="description">Описание:</label>
                    <textarea id="description" th:field="*{description}" maxlength="1000" placeholder="Описание"></textarea>
                </div>
                
                <!-- Адресные данные -->
                <div>
                    <label for="postalCode">Почтовый индекс:</label>
                    <input type="text" id="postalCode" th:field="*{postalCode}" maxlength="20" pattern="\d{6}" placeholder="Почтовый индекс">
                </div>
                <div>
                    <label for="houseNumber">Номер дома:</label>
                    <input type="text" id="houseNumber" th:field="*{houseNumber}" maxlength="10" required placeholder="Номер дома">
                </div>
                <div>
                    <label for="houseLetter">Литера дома:</label>
                    <input type="text" id="houseLetter" th:field="*{houseLetter}" maxlength="5" placeholder="Литера дома">
                </div>
                <div>
                    <label for="buildingNumber">Номер корпуса:</label>
                    <input type="text" id="buildingNumber" th:field="*{buildingNumber}" maxlength="10" placeholder="Номер корпуса">
                </div>
                <div>
                    <label for="apartmentNumber">Номер квартиры:</label>
                    <input type="text" id="apartmentNumber" th:field="*{apartmentNumber}" maxlength="10" placeholder="Номер квартиры">
                </div>
                
                <!-- Справочные данные -->
                <div>
                    <label for="idPropertyType">Тип недвижимости:</label>
                    <select id="idPropertyType" th:field="*{idPropertyType}" required>
                        <option value="">Выберите тип недвижимости</option>
                        <option th:each="type : ${propertyTypes}"
                                th:value="${type.idPropertyType}"
                                th:text="${type.propertyTypeName}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label for="idCountry">Страна:</label>
                    <select id="idCountry" th:field="*{idCountry}" required>
                        <option value="">Выберите страну</option>
                        <option th:each="country : ${countries}"
                                th:value="${country.idCountry}"
                                th:text="${country.countryName}">
                        </option>
                    </select>
                </div>

                <div>
                    <label for="idRegion">Регион:</label>
                    <select id="idRegion" th:field="*{idRegion}" required disabled>
                        <option value="">Выберите регион</option>
                    </select>
                </div>

                <div>
                    <label for="idCity">Город:</label>
                    <select id="idCity" th:field="*{idCity}" required disabled>
                        <option value="">Выберите город</option>
                    </select>
                </div>
                
                <div>
                    <label for="idDistrict">Район:</label>
                    <select id="idDistrict" th:field="*{idDistrict}" required disabled>
                        <option value="">Выберите район</option>
                    </select>
                </div>
                
                <div>
                    <label for="idStreet">Улица:</label>
                    <select id="idStreet" th:field="*{idStreet}" required disabled>
                        <option value="">Выберите улицу</option>
                    </select>
                </div>
                
                <button type="submit">Добавить</button>
            </form>
        </section>
        
        <!-- Форма "Найти недвижимость" -->
        <section>
            <h2>Найти недвижимость</h2>
            <!-- Присваиваем форме ID, чтобы JS мог ее найти -->
            <form th:action="@{/properties}" method="get" class="form-inline mb-3" id="propertySearchForm">
                <div>
                    <label for="minPrice">Мин. цена:</label>
                    <input type="number" id="minPrice" name="minPrice" th:value="${minPrice}" placeholder="Мин. цена" step="1000" min="0" max="99999999.99">
                </div>
                <div>
                    <label for="maxPrice">Макс. цена:</label>
                    <input type="number" id="maxPrice" name="maxPrice" th:value="${maxPrice}" placeholder="Макс. цена" step="1000" min="0" max="99999999.99">
                </div>
                
                <div>
                    <label for="searchCityId">Город:</label>
                    <select id="searchCityId" name="cityId">
                        <!-- th:selected используется для сохранения выбранного значения после отправки формы -->
                        <option value="">Город</option>
                        <option th:each="city : ${citiesWithDetails}"
                                th:value="${city.cityId}"
                                th:text="${city.getFullName()}"
                                th:selected="${city.cityId == cityId}">
                        </option>
                    </select>
                </div>

                <div>
                    <label for="searchDistrictId">Район:</label>
                    <select id="searchDistrictId" name="districtId" disabled>
                        <option value="">Район</option>
                    </select>
                </div>

                <div>
                    <label for="searchStreetId">Улица:</label>
                    <select id="searchStreetId" name="streetId" disabled>
                        <option value="">Улица</option>
                    </select>
                </div>
                
                <div>
                    <label for="propertyTypeId">Тип недвижимости:</label>
                    <select id="propertyTypeId" name="propertyTypeId">
                        <option value="">Тип недвижимости</option>
                        <option th:each="type : ${propertyTypes}"
                                th:value="${type.idPropertyType}"
                                th:text="${type.propertyTypeName}"
                                th:selected="${type.idPropertyType == propertyTypeId}">
                        </option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary mb-2">Поиск</button>
            </form>
        </section>
        
        <!-- Таблица недвижимости -->
        <section>
            <h2>Список недвижимости</h2>
            <div class="report-button-container">
                <a href="/properties/report" class="btn-report">Скачать отчет</a>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Адрес</th>
                        <th class="col-city">Город</th>
                        <th>Площадь</th>
                        <th>Стоимость</th>
                        <th>Описание</th>
                        <th>Тип</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="property : ${properties}" th:attr="data-id=${property.propertyId}">
                        <td th:text="${property.propertyId}"></td>
                        <td th:text="${property.getTableAddress()}"></td>
                        <td class="col-city" th:text="${property.cityName}"></td>
                        <td class="editable" th:text="${property.getAreaFormatted()}"></td>
                        <td class="editable" th:text="${property.getCostFormatted()}"></td>
                        <td class="editable" th:text="${property.getShortDescription()}"></td>
                        <td class="editable propertyType" th:text="${property.propertyTypeName}"></td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Количество записей -->
            <p>Всего записей: <span th:text="${#lists.size(properties)}">0</span></p>
        </section>
    </main>
    
    <div th:replace="~{_layout :: footer}">
        <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
        <script th:src="@{/js/property-search.js}"></script>
    </div>
</body>
</html>